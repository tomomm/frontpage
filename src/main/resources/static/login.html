<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <!--[if IE]>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <![endif]-->
    <title>LOGIN</title>
    <!-- BOOTSTRAP CORE STYLE  -->
    <link href="assets/css/bootstrap.css" rel="stylesheet" />
    <!-- FONT AWESOME STYLE  -->
    <link href="assets/css/font-awesome.css" rel="stylesheet" />
    <!-- DATATABLE STYLE  -->
    <link href="assets/js/dataTables/dataTables.bootstrap.css" rel="stylesheet" />
    <!-- CUSTOM STYLE  -->
    <link href="assets/css/style.css" rel="stylesheet" />
    <!-- GOOGLE FONT -->
    <link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css' />

</head>
<body ng-app="loginApp" ng-controller="loginCtrl">
<div class="navbar navbar-inverse set-radius-zero" >
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <!--<a class="navbar-brand" href="index.html">-->

                <!--<img src="assets/img/logo.png" />-->
            <!--</a>-->
            <h1>学术会议系统</h1>
        </div>

        <div class="btn-group right-div" role="group">
            <a href="signup.html" class="btn btn-danger">SIGN UP</a>
            <a href="login.html" class="btn btn-info">LOGIN</a>

        </div>
    </div>
</div>
<!-- LOGO HEADER END-->
<section class="menu-section">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="navbar-collapse collapse ">
                    <ul id="menu-top" class="nav navbar-nav navbar-right">
                        <li><a href="index.html" class="fa fa-home">首页</a></li>
                        <li><a href="conferenceList.html" class="fa fa-comments" >会议</a></li>
                        <li><a href="paperList.html" class="fa fa-book" > 论文</a></li>
                        <li><a href="userInfo.html" class=" fa fa-user">个人中心</a></li>


                    </ul>
                </div>
            </div>

        </div>
    </div>
</section>
<!-- MENU SECTION END-->
<div class="content-wrapper">
    <div class="container">
        <!--<div class="row pad-botm">-->
            <!--<div class="col-md-12">-->
                <!--<h4 class="header-line">TABLE EXAMPLES</h4>-->

            <!--</div>-->

        <!--</div>-->
        <div class="row">
            <div class="col-md-6">


        <div class="panel panel-default">
            <div class="panel-heading">
                LOGIN
            </div>
            <div class="panel-body">

                <!--<nav class="nav nav-pills nav-justified">-->
                    <!--<a class="flex-sm-fill text-sm-center nav-link active" href="#">用户密码登录</a>-->
                    <!--<a class="flex-sm-fill text-sm-center nav-link" href="#">短信验证码登录</a>-->

                <!--</nav>-->

                <ul id="myTab" class="nav nav-tabs nav-tabs-justified">
                    <li class="active">
                        <a href="#password" data-toggle="tab">
                            用户密码登录
                        </a>
                    </li>
                    <li><a href="#smscode" data-toggle="tab">短信验证码登录</a></li>

                </ul>

                <div class="tab-content">

                <form role="form" class="tab-pane fade in active" id="password" >

                    <div class="form-group">
                        <label>Enter Username</label>
                        <input ng-model="username" class="form-control" type="text" />
                        <!--<p class="help-block">Help text here.</p>-->
                    </div>

                    <div class="form-group">
                        <label>Enter Password</label>
                        <input ng-model="password" class="form-control" type="password" />
                        <!--<p class="help-block">Help text here.</p>-->
                    </div>

                    <div class="table-responsive">
                        <table   border="0" id="dataTables-examples">

                            <tbody>
                            <tr  class="odd gradeX">
                                <td><input id="RadioButtonList1_0" type="radio" ng-value="'user'" ng-model="radio" name="RadioButtonList1" value="普通用户" tabindex="4" ng-checked="true"/>
                                    <label for="RadioButtonList1_0" >普通用户</label>
                                <td><input id="RadioButtonList1_2" type="radio" ng-value="'admin'" ng-model="radio" name="RadioButtonList1" value="管理员" tabindex="4" />
                                <label for="RadioButtonList1_0" >管理员</label>
                            </tr>

                            <tr>
                                <td><a href="signup.html">注册</a></td>
                                <td><a href="forgetPassword.html">忘记密码?</a></td>
                            </tr>


                            </tbody>
                        </table>
                    </div>

                    <!--<div class="form-group">-->
                        <!--<div class="radio">-->
                            <!--<label>-->
                                <!--<input type="radio" name="optionsRadios" id="optionsRadios1" value="option1" checked="">用户-->
                            <!--</label>-->
                        <!--</div>-->
                        <!--<div class="radio">-->
                            <!--<label>-->
                                <!--<input type="radio" name="optionsRadios" id="optionsRadios2" value="option2">管理员-->
                            <!--</label>-->
                        <!--</div>-->
                    <!--</div>-->

                        <!--<a href="signup.html">注册</a>-->
                        <!--<a href="forgetPassword.html">忘记密码?</a>-->
                    <div>
                        <button  ng-click="func()" class="btn btn-danger">Login </button>
                    </div>
                </form>

                    <div class="tab-pane fade in" id="smscode">

                            <div class="form-group">
                                <label>Enter Phone</label>
                                <input ng-model="phone" class="form-control" type="text" />
                                <button class="btn btn-primary" ng-click="getSmsCode()">获取验证码</button>
                                <!--<p class="help-block">Help text here.</p>-->
                            </div>
                            <div>
                                <label>Enter code</label>
                                <input ng-model="smscode" class="form-control" type="number" />
                            </div>
                            <hr/>
                            <button class="btn btn-danger" ng-click="smsLogin()">login</button>

                    </div>



            </div>
            </div>
        </div>
        </div>
        </div>

    </div>
</div>
<!-- CONTENT-WRAPPER SECTION END-->
<section class="footer-section">
    <div class="container">
        <!--<div class="row">-->
            <!--<div class="col-md-12">-->
                <!--&copy; 2014 Yourdomain.com | More Templates <a href="http://www.cssmoban.com/" target="_blank" title="模板之家">模板之家</a> - Collect from <a href="http://www.cssmoban.com/" title="网页模板" target="_blank">网页模板</a></div>-->

        <!--</div>-->
    </div>
</section>
<!-- FOOTER SECTION END-->
<!-- JAVASCRIPT FILES PLACED AT THE BOTTOM TO REDUCE THE LOADING TIME  -->
<script src="webjars/angularjs/1.6.9/angular.js"></script>
<script src="webjars/angularjs/1.6.9/angular-cookies.js"></script>
<script src="assets/js/my.js"></script>
<script>
    var app = angular.module('loginApp',['ngCookies']);
    app.controller('loginCtrl',function($scope,$http,$cookies,$cookieStore) {
        var token = $cookieStore.get('token');

        function guid() {
            function S4() {
                return (((1+Math.random())*0x10000)|0).toString(16).substring(1);
            }
            return (S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4());
        }

        var deviceId = guid();

        $scope.radio = "user";
        $http({
            method:'GET',
            url: 'http://'+myHost+'/user/simpleshow',
            headers:{
                "Authorization":token
            }
        }).then(function successCallback(reponse) {
            // alert("success");
            window.location.href="userInfo.html";
            // $scope.user = reponse.data.data;
            // $scope.isLogin = true;
        },function errorCallback(reponse) {

            // $scope.isLogin = false;
            // window.location.href = 'login.html';
            // alert('请先登录');
            // alert('error');
        });

        $scope.func=function() {
            var str2 = "http://localhost:8080/authentication/form?username=erwin&password=3231433"

            var str = "http://localhost:8080/authentication/form?username=test&password=123456"




            alert($scope.radio);


                $http({
                    method: "post",
                    url: "http://"+myHost+"/authentication/form?username="+$scope.username +"&password="+$scope.password,
                    headers: {
                        "Content-Type": "application/x-www-form-urlencoded",
                        "Authorization": "Basic Y2xpZW50OjEyMzQ1Ng=="
                    }
                    /*
                        body:{"username":"erwin",
                                "password":"3231433"
                        },
                        headers:{

                        "Content-Type":"application/x-www-form-urlencoded",
                        "Authorization":"Basic Y2xpZW50OjEyMzQ1Ng=="

                        }
                        */
                }).then(function successCallback(reponse) {
                        alert(reponse.data.access_token);
                        var token = "bearer " + reponse.data.access_token;
                        $cookieStore.put('token', token, {
                            expires: new Date(new Date().getTime() + 50000)
                        });
                        // alert("sss"+$cookieStore.get('token'))

                        window.location.href = "loginBuf.html?"+$scope.radio;
                        // if($scope.radio == "user"){
                        //     window.location.href = "userInfo.html"
                        // }
                        // else if($scope.radio == "manager") {
                        //     window.location.href = "managerInfo.html"
                        // }

                    },
                    function errorCallback(response) {
                        // alert("error");
                        alert(response.data.data);
                    });


        }


        $scope.getSmsCode=function () {
            $http({
                method:'get',
                url: 'http://'+myHost+'/code/sms/'+deviceId+'?phone='+$scope.phone
            }).then(function successCallback(reponse) {
                alert("验证码已发送");
                // $scope.confs = reponse.data.data;
            },function errorCallback(reponse) {
                alert('error');
            });

        };
        
        $scope.smsLogin = function () {
            $http({
                method:'post',
                url: 'http://'+myHost+'/authentication/smsform'+'?smscode='+$scope.smscode+'&phone='+$scope.phone+'&deviceId='+deviceId,
                headers: {
                    "Content-Type": "application/x-www-form-urlencoded",
                    "Authorization": "Basic Y2xpZW50OjEyMzQ1Ng=="
                }
            }).then(function successCallback(reponse) {
                alert("success");
                var token = "bearer " + reponse.data.access_token;
                $cookieStore.put('token', token, {
                    expires: new Date(new Date().getTime() + 50000)
                });
                window.location.href="/userInfo.html";
                // $scope.confs = reponse.data.data;
            },function errorCallback(reponse) {
                alert('error');
            });
        }

    });

</script>


<!--<script src="/webjars/angularjs/1.7.7/angular.js"></script>-->
<!-- CORE JQUERY  -->
<script src="assets/js/jquery-1.10.2.js"></script>
<!-- BOOTSTRAP SCRIPTS  -->
<script src="assets/js/bootstrap.js"></script>
<!-- DATATABLE SCRIPTS  -->
<script src="assets/js/dataTables/jquery.dataTables.js"></script>
<script src="assets/js/dataTables/dataTables.bootstrap.js"></script>
<!-- CUSTOM SCRIPTS  -->
<script src="assets/js/custom.js"></script>
</body>
</html>
