<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <!--[if IE]>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">


    <![endif]-->
    <title>个人中心</title>
    <script src="http://code.angularjs.org/1.6.9/angular.min.js"></script>
    <script src="https://code.angularjs.org/1.6.9/angular-cookies.js"></script>
    <script src="assets/js/my.js"></script>

    <!-- BOOTSTRAP CORE STYLE  -->
    <link href="assets/css/bootstrap.css" rel="stylesheet" />
    <!-- FONT AWESOME STYLE  -->
    <link href="assets/css/font-awesome.css" rel="stylesheet" />
    <!-- DATATABLE STYLE  -->
    <link href="assets/js/dataTables/dataTables.bootstrap.css" rel="stylesheet" />
    <!-- CUSTOM STYLE  -->
    <link href="assets/css/style.css" rel="stylesheet" />
    <!-- GOOGLE FONT -->
    <link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css' />



</head>
<body ng-app="userInfoApp" ng-controller="userInfoCtrl" data-ng-init="onLoad()" ng-cloak>
<div class="navbar navbar-inverse set-radius-zero" >
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <h1>学术会议系统</h1>

        </div>

        <div class="right-div">
            <a href="#" class="btn btn-info pull-right" ng-click="logout()">LOG ME OUT</a>
        </div>
    </div>
</div>
<!-- LOGO HEADER END-->
<section class="menu-section">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="navbar-collapse collapse ">
                    <ul id="menu-top" class="nav navbar-nav navbar-right">
                        <li><a href="index.html" >首页</a></li>
                        <li><a href="conferenceList.html"  >会议</a></li>
                        <li><a href="paperList.html" > 论文</a></li>
                        <li><a href="userInfo.html" class="menu-top-active fa fa-user">个人中心</a></li>



                    </ul>
                </div>
            </div>

        </div>
    </div>
</section>
<!-- MENU SECTION END-->
<div class="content-wrapper">
    <div class="container">
        <!--<div class="row pad-botm">-->
            <!--<div class="col-md-12">-->
                <!--<h4 class="header-line">TABLE EXAMPLES</h4>-->

            <!--</div>-->

        <!--</div>-->
        <div class="row">
            <div class="col-md-10">
                <!-- Advanced Tables -->
                <div class="panel panel-default">
                    <div class="panel-heading">
                        基本信息
                    </div>
                    <div class="panel-body">
                        <h2>姓名: {{user.name}}</h2>
                        <p>邮箱: {{user.email}}</p>
                        <p>电话: {{user.phone}}</p>

                    </div>

                </div>
                <!--End Advanced Tables -->
            </div>

            <div class="col-md-2">
                <button class="btn btn-success">修改密码</button>
                <!--<hr/>-->

            </div>
        </div>

        <div class="row">
            <div class="col-md-10">
                <!-- Advanced Tables -->
                <div class="panel panel-default">
                    <div class="panel-heading">
                        参加的会议信息
                    </div>
                    <div class="panel-body">
                        <div class="table-responsive">
                            <table class="table table-striped table-bordered table-hover" id="dataTables-examples">
                                <thead>
                                <tr>
                                    <th>会议名称</th>
                                    <th>会议时间</th>
                                    <th>会议地点</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr ng-repeat="x in conference" class="odd gradeX">
                                    <td><a href="conferenceInfo.html?{{x.id}}" ng-bind="x.name"></a></td>
                                    <td ng-bind="x.date| date: 'yyyy-MM-dd HH:mm'"></td>
                                    <td class="center" ng-bind="x.address"></td>
                                </tr>


                                </tbody>
                            </table>
                        </div>

                    </div>
                </div>
                <!--End Advanced Tables -->
            </div>

        </div>

        <div class="row">
            <div class="col-md-10">
                <!-- Advanced Tables -->
                <div class="panel panel-default">
                    <div class="panel-heading">
                        创建的会议信息
                    </div>
                    <div class="panel-body">
                        <div class="table-responsive">
                            <table class="table table-striped table-bordered table-hover" id="dataTables-examples">
                                <thead>
                                <tr>
                                    <th>会议名称</th>
                                    <th>会议时间</th>
                                    <th>会议地点</th>
                                    <th>操作</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr ng-repeat="x in createConference" class="odd gradeX">
                                    <td><a href="conferenceInfo.html?{{x.id}}" ng-bind="x.name"></a></td>
                                    <td ng-bind="x.date| date: 'yyyy-MM-dd HH:mm'"></td>
                                    <td class="center" ng-bind="x.address"></td>
                                    <td><button class="btn btn-sm">删除会议</button></td>
                                </tr>


                                </tbody>
                            </table>
                        </div>

                    </div>
                </div>
                <!--End Advanced Tables -->
            </div>

        </div>

        <div class="row">
            <div class="col-md-10">
                <!-- Advanced Tables -->
                <div class="panel panel-default">
                    <div class="panel-heading">
                        投稿的论文信息
                    </div>
                    <div class="panel-body">
                        <div class="table-responsive">
                            <table class="table table-striped table-bordered table-hover" id="dataTables-examples">
                                <thead>
                                <tr>
                                    <th>论文标题</th>
                                    <th>提交时间</th>
                                    <th>论文评论</th>
                                    <th>操作</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr ng-repeat="x in papers" class="odd gradeX">
                                    <td><a href="#" ng-bind="x.paperTilte"></a></td>
                                    <td ng-bind="x.paperSubmitTime | date: 'yyyy-MM-dd HH:mm'"></td>
                                    <td class="center" ng-bind="x.paperComment"></td>
                                    <td><button class="btn btn-sm" ng-click="getExcel(x.paperId)">下载论文</button> </td>
                                </tr>


                                </tbody>
                            </table>
                        </div>

                    </div>
                </div>
                <!--End Advanced Tables -->
            </div>

        </div>


    </div>
</div>
<!-- CONTENT-WRAPPER SECTION END-->
<section class="footer-section">
    <div class="container">
        <!--<div class="row">-->
            <!--<div class="col-md-12">-->
                <!--&copy; 2014 Yourdomain.com | More Templates <a href="http://www.cssmoban.com/" target="_blank" title="模板之家">模板之家</a> - Collect from <a href="http://www.cssmoban.com/" title="网页模板" target="_blank">网页模板</a></div>-->

        <!--</div>-->
    </div>
</section>
<!-- FOOTER SECTION END-->
<!-- JAVASCRIPT FILES PLACED AT THE BOTTOM TO REDUCE THE LOADING TIME  -->


<script>
    app = angular.module('userInfoApp',['ngCookies']);
    app.controller('userInfoCtrl',function ($scope,$http,$cookieStore) {
        var token=$cookieStore.get('token');
        // alert("success");
        var host = "liuyuxin.xyz";

        $scope.onLoad=function ()
        {
            $http({
                method: 'GET',
                url: 'http://localhost:8080/user/simpleshow',
                headers: {
                    "Authorization": token
                }
            }).then(function successCallback(reponse) {

                $scope.user = reponse.data.data;

                $scope.conference = $scope.user.conferenceSet;
            }, function errorCallback(reponse) {
                // alert('error');

            });

            $http({
                method: 'GET',
                url: 'http://localhost:8080/user/show/create',
                headers: {
                    "Authorization": token
                }
            }).then(function successCallback(reponse) {
                $scope.createConference = reponse.data.data;
            }, function errorCallback(reponse) {
                // alert('error');
            });

            $http({
                method: 'GET',
                url: 'http://localhost:8080/paper/user',
                headers: {
                    "Authorization": token
                }
            }).then(function successCallback(reponse) {
                $scope.papers = reponse.data.data;
            });
        }



        $scope.logout=function () {
            $cookieStore.remove("token");
            window.location.href="/login.html";
        }

        $scope.download = function(id){
            alert(id);
            $http({
                method:'GET',
                url:'http://'+myHost+'/file/download/'+id+"?username=test",
                headers:{
                    "Authorization":token,
                    "Content-Type":"application/x-download"
                }
            }).then(function successCallback(reponse) {
                $scope.papers=reponse.data.data;
                alert("success")
            },function errorCallback(reponse) {
                alert("error");
            });
        };

        $scope.getExcel = function (id) {
            $http({
                method:'get',
                url:'http://'+myHost+'/file/download/'+id+'?username=test',
                responseType: 'blob',
                headers:{
                    "Authorization":token,
                    "Content-Type":"application/x-download"
                }
            }).then(function successCallback(response) {
                var blob = new Blob([response.data], {type: "application/x-download"});   // vnd.openxmlformats-officedocument.spreadsheetml.sheet"});
                // var fileName = response.headers("Content-Disposition");

                var fileName = response.headers("Content-Disposition").split(";")[1].split("filename=")[1];

                var fileNameUnicode = response.headers("Content-Disposition").split("filename*=")[1];

                if (fileNameUnicode) {        //当存在 filename* 时，取filename* 并进行解码（为了解决中文乱码问题）
                    fileName = decodeURIComponent(fileName);
                }

                var a = document.createElement("a");
                document.body.appendChild(a);
                a.download = fileName;
                a.href = URL.createObjectURL(blob);
                a.click();
            },function errorCallback(response) {
                alert("error");
            })
        }

    });
</script>

<!--<script src="/webjars/angularjs/1.7.7/angular.js"></script>-->
<!-- CORE JQUERY  -->
<script src="assets/js/jquery-1.10.2.js"></script>
<!-- BOOTSTRAP SCRIPTS  -->
<script src="assets/js/bootstrap.js"></script>
<!-- DATATABLE SCRIPTS  -->
<script src="assets/js/dataTables/jquery.dataTables.js"></script>
<script src="assets/js/dataTables/dataTables.bootstrap.js"></script>
<!-- CUSTOM SCRIPTS  -->
<script src="assets/js/custom.js"></script>
</body>
</html>
